# Multi-Agent-Customer-Service-System-with-A2A-and-MCP

This project implements a **multi-agent customer service automation system** that combines:

- **A2A (Agent-to-Agent) communication** – to coordinate specialized agents
- **MCP (Model Context Protocol)** – to access customer and ticket data via tools

It simulates realistic workflows such as account help, billing issues, ticket creation, and reporting for premium customers.

---

## 1. Project Structure

```text
Applied GenAI_Multi Ag/
├── a2a_servers.py        # Starts A2A HTTP servers for specialist agents
├── agents.py             # Customer Data Agent & Support Agent + Router (Orchestrator)
├── database_setup.py     # Creates SQLite schema & inserts sample data
├── mcp_server.py         # MCP server exposing DB operations as MCP tools
├── main.py               # end-to-end test scenarios
├── requirements.txt      # Python dependencies
└── support.db            # SQLite database file (generated by database_setup.py)
````

---

## 2. Agent Roles

### Router Agent (Orchestrator)

* Receives customer queries
* Detects intent
* Coordinates specialist agents via A2A
* Implements task allocation, negotiation, and multi-step workflows
* Returns final answer to the user

### Customer Data Agent

* Connected to the MCP server through `McpToolset`
* Uses MCP tools to:

  * Retrieve customer profiles
  * List customers with filters
  * Update customer fields
  * Get ticket history
  * Create tickets (when required)
* Summarizes raw JSON into concise, structured information

### Support Agent

* Handles general support, billing, subscription and account issues
* Reads context via MCP tools (customer info + ticket history)
* Decides when to escalate and create high-priority tickets
* Produces empathetic, user-facing responses

Both specialist agents are exposed as A2A services by `a2a_servers.py`.

---

## 3. MCP Server & Database

The MCP server is implemented in **`mcp_server.py`**.

### Database Initialization – `database_setup.py`

`database_setup.py` creates and populates the SQLite database:

Tables:

**Customers**

```text
id          INTEGER PRIMARY KEY
name        TEXT NOT NULL
email       TEXT
phone       TEXT
status      TEXT ('active' or 'disabled')
created_at  TIMESTAMP
updated_at  TIMESTAMP
```

**Tickets**

```text
id          INTEGER PRIMARY KEY
customer_id INTEGER  -- FK to customers.id
issue       TEXT NOT NULL
status      TEXT ('open', 'in_progress', 'resolved')
priority    TEXT ('low', 'medium', 'high')
created_at  TIMESTAMP
```

The script generates the database file `support.db` with sample customers and tickets.

### MCP Tools (in `mcp_server.py`)

The MCP server exposes the following tools:

* `get_customer(customer_id)`
* `list_customers(status, limit)`
* `update_customer(customer_id, data)`
* `create_ticket(customer_id, issue, priority)`
* `get_customer_history(customer_id)`

These tools are wrapped in MCP responses and streamed via **Server-Sent Events (SSE)** at:

```text
http://127.0.0.1:5000/mcp
```

A health check endpoint is also available:

```text
http://127.0.0.1:5000/health
```

---

## 4. A2A Coordination

`a2a_servers.py` uses Google ADK’s A2A support to expose:

| Agent               | Port  | Description                         |
| ------------------- | ----- | ----------------------------------- |
| Customer Data Agent | 10030 | Connects to MCP for data operations |
| Support Agent       | 10031 | General support and escalation      |

Each agent has an `AgentCard` describing its skills, and A2A servers are run with `uvicorn`.
The router (in `main.py`) talks to these URLs via A2A clients, logging:

```text
[R→Data] ...
[Data→R] ...
[R→Support] ...
[Support→R] ...
```

This explicit logging demonstrates agent-to-agent communication for the assignment.

---

## 5. Scenarios (Required by Assignment)

The router in `main.py` implements and tests the following:

### Scenario 1 – Task Allocation

**Example query:**

> `I need help with my account, customer ID 5`

---

### Scenario 2 – Negotiation / Escalation

**Example query:**

> `I want to cancel my subscription but I'm having billing issues`

---

### Scenario 3 – Multi-Step Coordination

**Example query:**

> `What's the status of all high-priority tickets for premium customers?`

---

## 6. Additional Test Scenarios

`main.py` also demonstrates:

* **Simple Query**
  `Get customer information for ID 5`

* **Escalation**
  `I've been charged twice, please refund immediately!`

* **Multi-Intent**
  `Update my email to new@email.com and show my ticket history. My customer ID is 1.`

---

## 7. Installation & Setup

### 1️⃣ Clone the repository

```bash
git clone https://github.com/<your-username>/applied-genai-multi-agent.git
cd "Applied GenAI_Multi Agent"
```

### 2️⃣ Create & activate virtual environment

```bash
python -m venv venv
# Windows
venv\Scripts\activate
# macOS / Linux
source venv/bin/activate
```

### 3️⃣ Install dependencies

```bash
pip install -r requirements.txt
```

### 4️⃣ Set environment variables

You must have a Google Gemini API key.

```bash
# Windows (PowerShell)
$env:GOOGLE_API_KEY="YOUR_API_KEY"
# macOS / Linux
export GOOGLE_API_KEY="YOUR_API_KEY"
```

---

## 8. Running the System (3 processes)

### Step 1 – Initialize Database

If the database does not exist or you want a clean reset:

```bash
python database_setup.py
```

This will create / overwrite `support.db` with sample data.

---

### Step 2 – Start MCP Server

```bash
python mcp_server.py
```

Expected output (simplified):

```text
✅ Database initialized / using support.db
✅ MCP server running at http://127.0.0.1:5000/mcp
```

---

### Step 3 – Start A2A Agent Servers

In a second terminal:

```bash
python a2a_servers.py
```

You should see:

```text
Customer Data Agent: http://127.0.0.1:10030/.well-known/agent.json
Support Agent      : http://127.0.0.1:10031/.well-known/agent.json
```

---

### Step 4 – Run Router & Scenarios

In a third terminal:

```bash
python main.py
```

You will see logs like:

```text
==== New Query ====
USER: Get customer information for ID 5

[R→Data] ...
[Data→R] ...
[R→Support] ...
[Support→R] ...
[Router] Final answer:
...
```

These logs can be captured and included in the assignment as evidence of:

* A2A communication
* MCP tool usage
* Multi-agent coordination

---

## 9. Requirements

`requirements.txt`:

```text
google-adk==1.9.0
a2a-sdk==0.3.0
google-generativeai
httpx
uvicorn
starlette
Flask
flask-cors
termcolor
pydantic
typing_extensions
```

---

## 10. What I Learned (Summary)

You can use this for your conclusion section:

```
Through this project, I learned how to design and implement
multi-agent systems using A2A communication patterns and
the Model Context Protocol (MCP). I gained hands-on experience
in coordinating specialized agents—Router, Support, and Data
Agent—while ensuring effective tool usage and state transitions
within a LangGraph workflow.

The biggest challenge was preventing infinite loops and
ensuring correct routing based on agent intents. I learned how
to encode agent-to-agent negotiation signals and design robust
routing rules that allow complex, multi-step coordination
(e.g., escalation, multi-intent queries, and chained data fetches).
This project significantly improved my understanding of modern
agent frameworks and production-grade workflow orchestration.
```


